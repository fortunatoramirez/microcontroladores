

## **Bloque 1: Directivas del preprocesador en C++**

### **1. Introducción teórica**

En C/C++, las directivas del preprocesador comienzan con el símbolo `#` y son instrucciones que se procesan **antes** de compilar el programa. No forman parte del lenguaje C++ en sí, sino que se ejecutan durante la fase de preprocesamiento.

Estas directivas permiten:

* Definir constantes simbólicas.
* Incluir archivos externos (`.h`).
* Activar o desactivar partes del código según condiciones.

#### 1.1. `#define`

Permite crear una constante simbólica. No ocupa memoria y es sustituida por su valor **en tiempo de compilación**.

```cpp
#define PI 3.1416
#define LED 2
```

Esto reemplaza todas las apariciones de `PI` y `LED` por sus valores respectivos antes de compilar.

#### 1.2. `#include`

Inserta el contenido de otro archivo en el programa. Se usa para agregar bibliotecas externas o definiciones propias:

```cpp
#include <Arduino.h>     // Biblioteca estándar
#include "mibiblioteca.h" // Archivo creado por el usuario
```

#### 1.3. `#ifdef`, `#ifndef`, `#endif`

Permiten compilar condicionalmente partes del código:

```cpp
#define MODO_DEBUG

#ifdef MODO_DEBUG
  Serial.println("Modo depuración activo");
#endif
```

Este fragmento se compilará solo si `MODO_DEBUG` ha sido definido.

#### 1.4. `#if`, `#else`, `#elif`

Se utilizan para evaluar condiciones más complejas:

```cpp
#define VERSION 2

#if VERSION == 1
  #define VELOCIDAD 100
#elif VERSION == 2
  #define VELOCIDAD 200
#else
  #define VELOCIDAD 50
#endif
```

Esto permite cambiar comportamientos del programa dependiendo de una constante definida.

---

### **2. Ejemplo de código base**

```cpp
#define MODO_DEBUG
#define LED 2

void setup() {
  pinMode(LED, OUTPUT);
  Serial.begin(9600);

  #ifdef MODO_DEBUG
    Serial.println("Depuración activada");
  #endif
}

void loop() {
  digitalWrite(LED, HIGH);
  delay(500);
  digitalWrite(LED, LOW);
  delay(500);

  #ifdef MODO_DEBUG
    Serial.println("LED encendido y apagado");
  #endif
}
```

---

### **3. Explicación paso a paso**

* `#define LED 2`: Define una constante para usar en lugar del número de pin.
* `#ifdef MODO_DEBUG`: El bloque de código que contiene `Serial.println()` solo se compila si `MODO_DEBUG` fue definido.
* Esto permite **activar o desactivar** funciones fácilmente para diferentes versiones del programa.

---

### **4. Ventajas del uso del preprocesador**

| Ventaja                        | Descripción                                                 |
| ------------------------------ | ----------------------------------------------------------- |
| Ahorro de memoria              | `#define` no ocupa RAM.                                     |
| Control condicional del código | Se puede compilar o excluir bloques según condiciones.      |
| Legibilidad y mantenimiento    | Uso de constantes simbólicas mejora la claridad del código. |
| Modularidad                    | Permite separar configuraciones o versiones del código.     |

---

### **5. Actividad de comprobación**

> **Ejercicio 1:**
>
> 1. Define `#define VELOCIDAD_LED 300`
> 2. Crea un programa que haga parpadear un LED conectado al pin 13 usando ese valor.
> 3. Agrega una directiva `#ifdef DEPURAR` que imprima `"LED ON"` y `"LED OFF"` cada vez que se cambie el estado del LED.
> 4. Comenta o descomenta `#define DEPURAR` y observa cómo el código cambia automáticamente.

---

## **Bloque 2: Creación de bibliotecas personalizadas (.h y .cpp)**

### **1. Introducción teórica**

En proyectos más complejos, dividir el código en archivos ayuda a organizar, reutilizar y mantener el proyecto más limpio. Para eso, se crean **bibliotecas personalizadas** usando archivos `.h` (cabecera) y `.cpp` (implementación).

Esto permite encapsular funciones, estructuras y constantes en módulos reutilizables.

#### 1.1. Archivo `.h` (header o cabecera)

Contiene las declaraciones de funciones, estructuras, variables externas y directivas del preprocesador. No contiene código ejecutable, solo definiciones.

```cpp
// miSensor.h
#ifndef MISENSOR_H
#define MISENSOR_H

void inicializarSensor();
float leerSensor();

#endif
```

#### 1.2. Archivo `.cpp`

Contiene la implementación de las funciones declaradas en el archivo `.h`.

```cpp
// miSensor.cpp
#include "miSensor.h"

void inicializarSensor() {
  // simulación de inicialización
  Serial.println("Sensor listo");
}

float leerSensor() {
  return analogRead(A0) * (5.0 / 1023.0);
}
```

#### 1.3. Inclusión en el programa principal

```cpp
#include <Arduino.h>
#include "miSensor.h"

void setup() {
  Serial.begin(9600);
  inicializarSensor();
}

void loop() {
  float valor = leerSensor();
  Serial.print("Valor leído: ");
  Serial.println(valor);
  delay(1000);
}
```

---

### **2. ¿Qué hace `#ifndef`, `#define`, `#endif`?**

Son mecanismos de **protección contra inclusión múltiple**, también conocidos como *include guards*. Aseguran que el contenido del archivo `.h` solo se incluya una vez, incluso si se hace referencia varias veces en diferentes archivos.

---

### **3. Ventajas del uso de bibliotecas propias**

| Ventaja              | Descripción                                              |
| -------------------- | -------------------------------------------------------- |
| Organización modular | Facilita la lectura y depuración.                        |
| Reutilización        | Se puede usar en varios proyectos.                       |
| Separación de lógica | El código principal queda limpio y enfocado.             |
| Escalabilidad        | Ideal para proyectos que crecen en tamaño y complejidad. |

---

### **4. Actividad de comprobación**

> **Ejercicio 2:**
>
> 1. Crea un archivo llamado `ledControl.h` con la declaración de dos funciones:
>
>    * `void encenderLed(byte pin);`
>    * `void apagarLed(byte pin);`
>
> 2. Crea un archivo llamado `ledControl.cpp` con la implementación de esas funciones usando `digitalWrite()`.
>
> 3. En el programa principal (`.ino`):
>
>    * Incluye el archivo `.h`
>    * En `setup()`, configura el pin 5 como salida.
>    * En `loop()`, alterna entre encender y apagar el LED con un `delay(500)`.
>
> 4. Usa `#define LED_PIN 5` en el archivo `.ino`.

---




